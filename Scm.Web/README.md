# Настройка SMTP для разработки

Для отправки писем сервис использует Gmail SMTP. Рабочий пароль приложения не хранится в репозитории и должен задаваться одним из следующих способов:

1. **Через Secret Manager** (предпочтительно для локальной разработки):

   ```bash
   dotnet user-secrets init --project Scm.Web
   dotnet user-secrets set "Mail:Password" "<пароль_без_пробелов>"
   ```

2. **Через переменные окружения** (подходит для CI/CD и контейнеров):

   ```bash
   export Mail__Password="<пароль_без_пробелов>"
   ```

> Пароль должен быть скопирован без пробелов — используйте строку из 16 латинских букв и цифр, которую выдает Google при создании пароля приложения. Если пароль содержит пробелы, сервис автоматически уберёт их, но при некорректном формате отправка писем будет заблокирована, а в логах появится подсказка.

Для проверки конфигурации можно запросить `/health` после запуска приложения. При включенной пробной отправке будет выполнен тестовый вызов SMTP-отправки на указанный адрес.

## Роли и доступы

Веб-интерфейс использует ролевую модель безопасности. Для повторного использования настроены именованные политики авторизации:

| Политика | Роли | Назначение |
| --- | --- | --- |
| `AdministrationAccess` | Admin | Управление пользователями и ролями |
| `OrdersAccess` | Admin, Manager, Technician | Операции сервиса, заказы, статусные действия |
| `StockAccess` | Admin, Manager, Storekeeper | Складской модуль |
| `ReportsAccess` | Admin, Manager, Accountant | Панель отчетов и конструктор отчетов |
| `CrmAccess` | Admin, Manager, Technician, Support | CRM разделы (контрагенты, контакты, сделки, задачи, тикеты) |
| `MessagesAccess` | Admin, Manager, Technician, Support | Отправка внутренних сообщений заказов |

Пункт меню «Пользователи» доступен только роли Admin. Разделы «Склад» и «Отчёты» скрываются у пользователей без соответствующих прав.
